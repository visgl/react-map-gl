{"version":3,"sources":["../../../src/utils/style-utils.js"],"names":["refProps","normalizeStyle","style","toJS","layerIndex","layers","layer","id","map","layerRef","ref","normalizedLayer","interactive","propName"],"mappings":";;;;;;;;;;;;AAQA,IAAMA,QAAQ,GAAG,CAAC,MAAD,EAAS,QAAT,EAAmB,cAAnB,EAAmC,SAAnC,EAA8C,SAA9C,EAAyD,QAAzD,EAAmE,QAAnE,CAAjB;AAKA,OAAO,SAASC,cAAT,CAAwBC,KAAxB,EAA2D;AAChE,MAAI,CAACA,KAAL,EAAY;AACV,WAAO,IAAP;AACD;;AACD,MAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC7B,WAAOA,KAAP;AACD;;AACD,MAAIA,KAAK,CAACC,IAAV,EAAgB;AACdD,IAAAA,KAAK,GAAGA,KAAK,CAACC,IAAN,EAAR;AACD;;AACD,MAAMC,UAAU,GAAG,EAAnB;;AAVgE,6CAY5CF,KAAK,CAACG,MAZsC;AAAA;;AAAA;AAYhE,wDAAkC;AAAA,UAAvBC,KAAuB;AAChCF,MAAAA,UAAU,CAACE,KAAK,CAACC,EAAP,CAAV,GAAuBD,KAAvB;AACD;AAd+D;AAAA;AAAA;AAAA;AAAA;;AAgBhE,MAAMD,MAAM,GAAGH,KAAK,CAACG,MAAN,CAAaG,GAAb,CAAiB,UAAAF,KAAK,EAAI;AACvC,QAAMG,QAAQ,GAAGL,UAAU,CAACE,KAAK,CAACI,GAAP,CAA3B;AACA,QAAIC,eAAe,GAAG,IAAtB;;AAEA,QAAI,iBAAiBL,KAArB,EAA4B;AAC1BK,MAAAA,eAAe,qBAAOL,KAAP,CAAf;AAEA,aAAOK,eAAe,CAACC,WAAvB;AACD;;AAGD,QAAIH,QAAJ,EAAc;AACZE,MAAAA,eAAe,GAAGA,eAAe,sBAAQL,KAAR,CAAjC;AACA,aAAOK,eAAe,CAACD,GAAvB;;AAFY,kDAIWV,QAJX;AAAA;;AAAA;AAIZ,+DAAiC;AAAA,cAAtBa,QAAsB;;AAC/B,cAAIA,QAAQ,IAAIJ,QAAhB,EAA0B;AACxBE,YAAAA,eAAe,CAACE,QAAD,CAAf,GAA4BJ,QAAQ,CAACI,QAAD,CAApC;AACD;AACF;AARW;AAAA;AAAA;AAAA;AAAA;AASb;;AAED,WAAOF,eAAe,IAAIL,KAA1B;AACD,GAvBc,CAAf;AA0BA,yCAAWJ,KAAX;AAAkBG,IAAAA,MAAM,EAANA;AAAlB;AACD","sourcesContent":["// @flow\ntype MapboxStyle =\n  | string\n  | {\n      toJS?: Function,\n      layers: Array<any>\n    };\n\nconst refProps = ['type', 'source', 'source-layer', 'minzoom', 'maxzoom', 'filter', 'layout'];\n\n// Prepare a map style object for diffing\n// If immutable - convert to plain object\n// Work around some issues in the styles that would fail Mapbox's diffing\nexport function normalizeStyle(style: ?MapboxStyle): ?MapboxStyle {\n  if (!style) {\n    return null;\n  }\n  if (typeof style === 'string') {\n    return style;\n  }\n  if (style.toJS) {\n    style = style.toJS();\n  }\n  const layerIndex = {};\n\n  for (const layer of style.layers) {\n    layerIndex[layer.id] = layer;\n  }\n\n  const layers = style.layers.map(layer => {\n    const layerRef = layerIndex[layer.ref];\n    let normalizedLayer = null;\n\n    if ('interactive' in layer) {\n      normalizedLayer = {...layer};\n      // Breaks style diffing :(\n      delete normalizedLayer.interactive;\n    }\n\n    // Style diffing doesn't work with refs so expand them out manually before diffing.\n    if (layerRef) {\n      normalizedLayer = normalizedLayer || {...layer};\n      delete normalizedLayer.ref;\n      // https://github.com/mapbox/mapbox-gl-js/blob/master/src/style-spec/deref.js\n      for (const propName of refProps) {\n        if (propName in layerRef) {\n          normalizedLayer[propName] = layerRef[propName];\n        }\n      }\n    }\n\n    return normalizedLayer || layer;\n  });\n\n  // Do not mutate the style object provided by the user\n  return {...style, layers};\n}\n"],"file":"style-utils.js"}