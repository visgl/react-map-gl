{"version":3,"sources":["../../../src/components/interactive-map.js"],"names":["React","PureComponent","createRef","PropTypes","StaticMap","MAPBOX_LIMITS","WebMercatorViewport","TransitionManager","MapContext","EventManager","MapController","deprecateWarn","propTypes","Object","assign","maxZoom","number","minZoom","maxPitch","minPitch","onViewStateChange","func","onViewportChange","onInteractionStateChange","transitionDuration","oneOfType","string","transitionInterpolator","object","transitionInterruption","transitionEasing","onTransitionStart","onTransitionInterrupt","onTransitionEnd","scrollZoom","bool","dragPan","dragRotate","doubleClickZoom","touchZoom","touchRotate","keyboard","onHover","onClick","onDblClick","onContextMenu","onMouseDown","onMouseMove","onMouseUp","onTouchStart","onTouchMove","onTouchEnd","onMouseEnter","onMouseLeave","onMouseOut","onWheel","touchAction","clickRadius","interactiveLayerIds","array","getCursor","controller","instanceOf","getDefaultCursor","isDragging","isHovering","defaultProps","onNativeClick","event","preventDefault","InteractiveMap","supported","constructor","props","isLoaded","_staticMapRef","current","getMap","geometry","options","map","queryRenderedFeatures","interactionState","state","_updateInteractiveContext","setState","width","height","_width","_height","_setControllerProps","onResize","viewState","oldViewState","onLoad","callbackName","_normalizeEvent","pointerType","_onEvent","features","_getFeatures","pos","point","radius","Boolean","length","isEntering","isExiting","callbacks","isDoubleClickEnabled","type","push","filter","forEach","cb","_controller","_eventManager","eventManager","componentDidMount","mapContainer","_eventCanvasRef","setElement","on","pointerdown","_onPointerDown","pointermove","_onPointerMove","pointerup","_onPointerUp","pointerleave","bind","click","_onClick","anyclick","dblclick","wheel","contextmenu","componentDidUpdate","componentWillUnmount","destroy","isInteractive","_onViewportChange","onStateChange","_onInteractionStateChange","setOptions","context","_interactiveContext","queryParams","layers","size","bbox","updatedContext","lngLat","offsetCenter","x","y","viewport","unproject","render","style","eventCanvasStyle","position","cursor","_onResize","_onLoad","children"],"mappings":"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","sourcesContent":["// @flow\nimport * as React from 'react';\nimport {PureComponent, createRef} from 'react';\nimport PropTypes from 'prop-types';\n\nimport StaticMap from './static-map';\nimport {MAPBOX_LIMITS} from '../utils/map-state';\nimport WebMercatorViewport from 'viewport-mercator-project';\n\nimport TransitionManager from '../utils/transition-manager';\nimport MapContext from './map-context';\n\nimport {EventManager} from 'mjolnir.js';\nimport MapController from '../utils/map-controller';\nimport deprecateWarn from '../utils/deprecate-warn';\n\nimport type {ViewState} from '../mapbox/mapbox';\nimport type {StaticMapProps} from './static-map';\nimport type {MjolnirEvent} from 'mjolnir.js';\nimport type {MapContextProps} from './map-context';\n\nconst propTypes = Object.assign({}, StaticMap.propTypes, {\n  // Additional props on top of StaticMap\n\n  /** Viewport constraints */\n  // Max zoom level\n  maxZoom: PropTypes.number,\n  // Min zoom level\n  minZoom: PropTypes.number,\n  // Max pitch in degrees\n  maxPitch: PropTypes.number,\n  // Min pitch in degrees\n  minPitch: PropTypes.number,\n\n  // Callbacks fired when the user interacted with the map. The object passed to the callbacks\n  // contains viewport properties such as `longitude`, `latitude`, `zoom` etc.\n  onViewStateChange: PropTypes.func,\n  onViewportChange: PropTypes.func,\n  onInteractionStateChange: PropTypes.func,\n\n  /** Viewport transition **/\n  // transition duration for viewport change\n  transitionDuration: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  // TransitionInterpolator instance, can be used to perform custom transitions.\n  transitionInterpolator: PropTypes.object,\n  // type of interruption of current transition on update.\n  transitionInterruption: PropTypes.number,\n  // easing function\n  transitionEasing: PropTypes.func,\n  // transition status update functions\n  onTransitionStart: PropTypes.func,\n  onTransitionInterrupt: PropTypes.func,\n  onTransitionEnd: PropTypes.func,\n\n  /** Enables control event handling */\n  // Scroll to zoom\n  scrollZoom: PropTypes.bool,\n  // Drag to pan\n  dragPan: PropTypes.bool,\n  // Drag to rotate\n  dragRotate: PropTypes.bool,\n  // Double click to zoom\n  doubleClickZoom: PropTypes.bool,\n  // Multitouch zoom\n  touchZoom: PropTypes.bool,\n  // Multitouch rotate\n  touchRotate: PropTypes.bool,\n  // Keyboard\n  keyboard: PropTypes.bool,\n\n  /** Event callbacks */\n  onHover: PropTypes.func,\n  onClick: PropTypes.func,\n  onDblClick: PropTypes.func,\n  onContextMenu: PropTypes.func,\n  onMouseDown: PropTypes.func,\n  onMouseMove: PropTypes.func,\n  onMouseUp: PropTypes.func,\n  onTouchStart: PropTypes.func,\n  onTouchMove: PropTypes.func,\n  onTouchEnd: PropTypes.func,\n  onMouseEnter: PropTypes.func,\n  onMouseLeave: PropTypes.func,\n  onMouseOut: PropTypes.func,\n  onWheel: PropTypes.func,\n\n  /** Custom touch-action CSS for the event canvas. Defaults to 'none' */\n  touchAction: PropTypes.string,\n\n  /** Radius to detect features around a clicked point. Defaults to 0. */\n  clickRadius: PropTypes.number,\n\n  /** List of layers that are interactive */\n  interactiveLayerIds: PropTypes.array,\n\n  /** Accessor that returns a cursor style to show interactive state */\n  getCursor: PropTypes.func,\n\n  // A map control instance to replace the default map controller\n  // The object must expose a method: `setOptions(opts)`\n  controller: PropTypes.instanceOf(MapController)\n});\n\ntype State = {\n  isLoaded: boolean,\n  isDragging: boolean,\n  isHovering: boolean\n};\n\nconst getDefaultCursor = ({isDragging, isHovering}: State) =>\n  isDragging ? 'grabbing' : isHovering ? 'pointer' : 'grab';\n\nconst defaultProps = Object.assign(\n  {},\n  StaticMap.defaultProps,\n  MAPBOX_LIMITS,\n  TransitionManager.defaultProps,\n  {\n    onViewStateChange: null,\n    onViewportChange: null,\n    onClick: null,\n    onNativeClick: null,\n    onHover: null,\n    onContextMenu: (event: MouseEvent) => event.preventDefault(),\n\n    scrollZoom: true,\n    dragPan: true,\n    dragRotate: true,\n    doubleClickZoom: true,\n    touchZoom: true,\n    touchRotate: false,\n    keyboard: true,\n\n    touchAction: 'none',\n    clickRadius: 0,\n    getCursor: getDefaultCursor\n  }\n);\n\ntype InteractionState = {\n  isDragging: boolean\n};\n\ntype MapEvent = MjolnirEvent & {\n  point: Array<number>,\n  lngLat: Array<number>,\n  features: ?Array<any>\n};\n\nexport type InteractiveMapProps = StaticMapProps & {\n  onViewStateChange: Function,\n  onViewportChange: Function,\n  onInteractionStateChange: Function,\n  onHover: Function,\n  onClick: Function,\n  onNativeClick: Function,\n  onDblClick: Function,\n  onContextMenu: Function,\n  onMouseDown: Function,\n  onMouseMove: Function,\n  onMouseUp: Function,\n  onTouchStart: Function,\n  onTouchMove: Function,\n  onTouchEnd: Function,\n  onMouseEnter: Function,\n  onMouseLeave: Function,\n  onMouseOut: Function,\n  onWheel: Function,\n\n  transitionDuration: number,\n  transitionInterpolator: any,\n  transitionInterruption: number,\n  transitionEasing: Function,\n\n  scrollZoom: boolean,\n  dragPan: boolean,\n  dragRotate: boolean,\n  doubleClickZoom: boolean,\n  touchZoom: boolean,\n  touchRotate: boolean,\n  keyboard: boolean,\n\n  touchAction: string,\n  clickRadius: number,\n  interactiveLayerIds: Array<string>,\n  getCursor: Function,\n  controller: MapController\n};\n\nexport default class InteractiveMap extends PureComponent<InteractiveMapProps, State> {\n  static supported() {\n    return StaticMap.supported();\n  }\n\n  static propTypes = propTypes;\n  static defaultProps = defaultProps;\n\n  constructor(props: InteractiveMapProps) {\n    super(props);\n    // Check for deprecated props\n    deprecateWarn(props);\n\n    // If props.controller is not provided, fallback to default MapController instance\n    // Cannot use defaultProps here because it needs to be per map instance\n    this._controller = props.controller || new MapController();\n\n    this._eventManager = new EventManager(null, {\n      touchAction: props.touchAction\n    });\n\n    this._updateInteractiveContext({\n      isDragging: false,\n      eventManager: this._eventManager\n    });\n  }\n\n  state: State = {\n    // Whether mapbox styles have finished loading\n    isLoaded: false,\n    // Whether the cursor is down\n    isDragging: false,\n    // Whether the cursor is over a clickable feature\n    isHovering: false\n  };\n\n  componentDidMount() {\n    const eventManager = this._eventManager;\n\n    const mapContainer = this._eventCanvasRef.current;\n    eventManager.setElement(mapContainer);\n    // Register additional event handlers for click and hover\n    eventManager.on({\n      pointerdown: this._onPointerDown,\n      pointermove: this._onPointerMove,\n      pointerup: this._onPointerUp,\n      pointerleave: this._onEvent.bind(this, 'onMouseOut'),\n      click: this._onClick,\n      anyclick: this._onClick,\n      dblclick: this._onEvent.bind(this, 'onDblClick'),\n      wheel: this._onEvent.bind(this, 'onWheel'),\n      contextmenu: this._onEvent.bind(this, 'onContextMenu')\n    });\n\n    this._setControllerProps(this.props);\n\n    this._updateInteractiveContext({mapContainer});\n  }\n\n  componentDidUpdate() {\n    this._setControllerProps(this.props);\n  }\n\n  componentWillUnmount() {\n    this._eventManager.destroy();\n  }\n\n  _controller: MapController;\n  _eventManager: any;\n  _interactiveContext: MapContextProps;\n  _width: number = 0;\n  _height: number = 0;\n  _eventCanvasRef: {current: null | HTMLDivElement} = createRef();\n  _staticMapRef: {current: null | StaticMap} = createRef();\n\n  getMap = () => {\n    return this._staticMapRef.current ? this._staticMapRef.current.getMap() : null;\n  };\n\n  queryRenderedFeatures = (geometry: any, options: any = {}) => {\n    const map = this.getMap();\n    return map && map.queryRenderedFeatures(geometry, options);\n  };\n\n  _setControllerProps(props: InteractiveMapProps) {\n    props = Object.assign({}, props, props.viewState, {\n      isInteractive: Boolean(props.onViewStateChange || props.onViewportChange),\n      onViewportChange: this._onViewportChange,\n      onStateChange: this._onInteractionStateChange,\n      eventManager: this._eventManager,\n      width: this._width,\n      height: this._height\n    });\n\n    this._controller.setOptions(props);\n\n    // Pass callbacks via MapContext\n    // Do not create a new context object because these do not affect render\n    const context = this._interactiveContext;\n    context.onViewportChange = props.onViewportChange;\n    context.onViewStateChange = props.onViewStateChange;\n  }\n\n  _getFeatures({pos, radius}: {pos: Array<number>, radius: number}) {\n    let features;\n    const queryParams = {};\n    const map = this.getMap();\n\n    if (this.props.interactiveLayerIds) {\n      queryParams.layers = this.props.interactiveLayerIds;\n    }\n\n    if (radius) {\n      // Radius enables point features, like marker symbols, to be clicked.\n      const size = radius;\n      const bbox = [[pos[0] - size, pos[1] + size], [pos[0] + size, pos[1] - size]];\n      features = map && map.queryRenderedFeatures(bbox, queryParams);\n    } else {\n      features = map && map.queryRenderedFeatures(pos, queryParams);\n    }\n    return features;\n  }\n\n  _onInteractionStateChange = (interactionState: InteractionState) => {\n    const {isDragging = false} = interactionState;\n    if (isDragging !== this.state.isDragging) {\n      this._updateInteractiveContext({isDragging});\n      this.setState({isDragging});\n    }\n\n    const {onInteractionStateChange} = this.props;\n    if (onInteractionStateChange) {\n      onInteractionStateChange(interactionState);\n    }\n  };\n\n  _updateInteractiveContext(updatedContext: $Shape<MapContextProps>) {\n    this._interactiveContext = Object.assign({}, this._interactiveContext, updatedContext);\n  }\n\n  _onResize = ({width, height}: {width: number, height: number}) => {\n    this._width = width;\n    this._height = height;\n    this._setControllerProps(this.props);\n    this.props.onResize({width, height});\n  };\n\n  _onViewportChange = (\n    viewState: ViewState,\n    interactionState: InteractionState,\n    oldViewState: ViewState\n  ) => {\n    const {onViewStateChange, onViewportChange} = this.props;\n\n    if (onViewStateChange) {\n      onViewStateChange({viewState, interactionState, oldViewState});\n    }\n    if (onViewportChange) {\n      onViewportChange(viewState, interactionState, oldViewState);\n    }\n  };\n\n  /* Generic event handling */\n  _normalizeEvent(event: MapEvent) {\n    if (event.lngLat) {\n      // Already unprojected\n      return event;\n    }\n\n    const {\n      offsetCenter: {x, y}\n    } = event;\n    const pos = [x, y];\n\n    const viewport = new WebMercatorViewport(\n      // $FlowFixMe\n      Object.assign({}, this.props, {\n        width: this._width,\n        height: this._height\n      })\n    );\n\n    event.point = pos;\n    event.lngLat = viewport.unproject(pos);\n\n    return event;\n  }\n\n  _onLoad = (event: MapEvent) => {\n    this.setState({isLoaded: true});\n    this.props.onLoad(event);\n  };\n\n  _onEvent = (callbackName: string, event: MapEvent) => {\n    const func = this.props[callbackName];\n    if (func) {\n      func(this._normalizeEvent(event));\n    }\n  };\n\n  /* Special case event handling */\n  _onPointerDown = (event: MapEvent) => {\n    switch (event.pointerType) {\n      case 'touch':\n        this._onEvent('onTouchStart', event);\n        break;\n\n      default:\n        this._onEvent('onMouseDown', event);\n    }\n  };\n\n  _onPointerUp = (event: MapEvent) => {\n    switch (event.pointerType) {\n      case 'touch':\n        this._onEvent('onTouchEnd', event);\n        break;\n\n      default:\n        this._onEvent('onMouseUp', event);\n    }\n  };\n\n  // eslint-disable-next-line complexity\n  _onPointerMove = (event: MapEvent) => {\n    switch (event.pointerType) {\n      case 'touch':\n        this._onEvent('onTouchMove', event);\n        break;\n\n      default:\n        this._onEvent('onMouseMove', event);\n    }\n\n    if (!this.state.isDragging) {\n      const {onHover, interactiveLayerIds} = this.props;\n      let features;\n      event = this._normalizeEvent(event);\n      if (this.state.isLoaded && (interactiveLayerIds || onHover)) {\n        features = this._getFeatures({\n          pos: event.point,\n          radius: this.props.clickRadius\n        });\n      }\n      if (onHover) {\n        // backward compatibility: v3 `onHover` interface\n        event.features = features;\n        onHover(event);\n      }\n\n      const isHovering = Boolean(interactiveLayerIds && features && features.length > 0);\n      const isEntering = isHovering && !this.state.isHovering;\n      const isExiting = !isHovering && this.state.isHovering;\n\n      if (isEntering) {\n        this._onEvent('onMouseEnter', event);\n      }\n      if (isExiting) {\n        this._onEvent('onMouseLeave', event);\n      }\n      if (isEntering || isExiting) {\n        this.setState({isHovering});\n      }\n    }\n  };\n\n  _onClick = (event: MapEvent) => {\n    const {onClick, onNativeClick, onDblClick, doubleClickZoom} = this.props;\n    let callbacks = [];\n    const isDoubleClickEnabled = onDblClick || doubleClickZoom;\n\n    // `click` is only fired on single click. `anyclick` is fired twice if double clicking.\n    // `click` has a delay period after pointer up that prevents it from firing when\n    // double clicking. `anyclick` is always fired immediately after pointer up.\n    // If double click is turned off by the user, we want to immediately fire the\n    // onClick event. Otherwise, we wait to make sure it's a single click.\n    switch (event.type) {\n      case 'anyclick':\n        callbacks.push(onNativeClick);\n        if (!isDoubleClickEnabled) {\n          callbacks.push(onClick);\n        }\n        break;\n\n      case 'click':\n        if (isDoubleClickEnabled) {\n          callbacks.push(onClick);\n        }\n        break;\n\n      default:\n    }\n\n    callbacks = callbacks.filter(Boolean);\n\n    if (callbacks.length) {\n      event = this._normalizeEvent(event);\n      // backward compatibility: v3 `onClick` interface\n      event.features = this._getFeatures({\n        pos: event.point,\n        radius: this.props.clickRadius\n      });\n      callbacks.forEach(cb => cb(event));\n    }\n  };\n\n  render() {\n    const {width, height, style, getCursor} = this.props;\n\n    const eventCanvasStyle = Object.assign({position: 'relative'}, style, {\n      width,\n      height,\n      cursor: getCursor(this.state)\n    });\n\n    return (\n      <MapContext.Provider value={this._interactiveContext}>\n        <div key=\"event-canvas\" ref={this._eventCanvasRef} style={eventCanvasStyle}>\n          <StaticMap\n            {...this.props}\n            width=\"100%\"\n            height=\"100%\"\n            style={null}\n            onResize={this._onResize}\n            onLoad={this._onLoad}\n            ref={this._staticMapRef}\n          >\n            {this.props.children}\n          </StaticMap>\n        </div>\n      </MapContext.Provider>\n    );\n  }\n}\n"],"file":"interactive-map.js"}