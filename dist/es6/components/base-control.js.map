{"version":3,"sources":["../../../src/components/base-control.js"],"names":["React","PureComponent","createRef","PropTypes","MapContext","propTypes","captureScroll","bool","captureDrag","captureClick","captureDoubleClick","capturePointerMove","defaultProps","BaseControl","evt","props","stopPropagation","componentDidMount","ref","_containerRef","current","eventManager","_context","_events","wheel","_onScroll","panstart","_onDragStart","anyclick","_onClick","click","dblclick","_onDblClick","pointermove","_onPointerMove","watch","componentWillUnmount","off","_render","Error","render","context"],"mappings":"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","sourcesContent":["// @flow\n// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport * as React from 'react';\nimport {PureComponent, createRef} from 'react';\nimport PropTypes from 'prop-types';\nimport MapContext from './map-context';\n\nimport type {MjolnirEvent} from 'mjolnir.js';\n\nconst propTypes = {\n  /** Event handling */\n  captureScroll: PropTypes.bool,\n  // Stop map pan & rotate\n  captureDrag: PropTypes.bool,\n  // Stop map click\n  captureClick: PropTypes.bool,\n  // Stop map double click\n  captureDoubleClick: PropTypes.bool,\n  // Stop map pointer move\n  capturePointerMove: PropTypes.bool\n};\n\nconst defaultProps = {\n  captureScroll: false,\n  captureDrag: true,\n  captureClick: true,\n  captureDoubleClick: true,\n  capturePointerMove: false\n};\n\nexport type BaseControlProps = {\n  captureScroll: boolean,\n  captureDrag: boolean,\n  captureClick: boolean,\n  captureDoubleClick: boolean,\n  capturePointerMove: boolean,\n  children?: any\n};\n\n/*\n * PureComponent doesn't update when context changes.\n * The only way is to implement our own shouldComponentUpdate here. Considering\n * the parent component (StaticMap or InteractiveMap) is pure, and map re-render\n * is almost always triggered by a viewport change, we almost definitely need to\n * recalculate the marker's position when the parent re-renders.\n */\nexport default class BaseControl<\n  Props: BaseControlProps,\n  State: any,\n  ContainerType: Element\n> extends PureComponent<Props, State> {\n  static propTypes = propTypes;\n  static defaultProps = defaultProps;\n\n  componentDidMount() {\n    const ref = this._containerRef.current;\n    if (!ref) {\n      return;\n    }\n\n    const {eventManager} = this._context;\n\n    // Return early if no eventManager is found\n    if (eventManager) {\n      this._events = {\n        wheel: this._onScroll,\n        panstart: this._onDragStart,\n        anyclick: this._onClick,\n        click: this._onClick,\n        dblclick: this._onDblClick,\n        pointermove: this._onPointerMove\n      };\n      eventManager.watch(this._events, ref);\n    }\n  }\n\n  componentWillUnmount() {\n    const {eventManager} = this._context;\n    if (eventManager && this._events) {\n      eventManager.off(this._events);\n    }\n  }\n\n  _context: any = {};\n  _events: any = null;\n  _containerRef: {current: null | ContainerType} = createRef();\n\n  _onScroll = (evt: MjolnirEvent) => {\n    if (this.props.captureScroll) {\n      evt.stopPropagation();\n    }\n  };\n\n  _onDragStart = (evt: MjolnirEvent) => {\n    if (this.props.captureDrag) {\n      evt.stopPropagation();\n    }\n  };\n\n  _onDblClick = (evt: MjolnirEvent) => {\n    if (this.props.captureDoubleClick) {\n      evt.stopPropagation();\n    }\n  };\n\n  _onClick = (evt: MjolnirEvent) => {\n    if (this.props.captureClick) {\n      evt.stopPropagation();\n    }\n  };\n\n  _onPointerMove = (evt: MjolnirEvent) => {\n    if (this.props.capturePointerMove) {\n      evt.stopPropagation();\n    }\n  };\n\n  _render() {\n    throw new Error('_render() not implemented');\n  }\n\n  render() {\n    return (\n      <MapContext.Consumer>\n        {context => {\n          this._context = context;\n          return this._render();\n        }}\n      </MapContext.Consumer>\n    );\n  }\n}\n"],"file":"base-control.js"}