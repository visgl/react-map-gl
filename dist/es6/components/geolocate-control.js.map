{"version":3,"sources":["../../../src/components/geolocate-control.js"],"names":["React","createRef","PropTypes","WebMercatorViewport","mapboxgl","BaseControl","Marker","MapState","TransitionManager","isGeolocationSupported","LINEAR_TRANSITION_PROPS","Object","assign","defaultProps","transitionDuration","noop","propTypes","className","string","style","object","label","auto","bool","positionOptions","fitBoundsOptions","trackUserLocation","showUserLocation","onViewStateChange","func","onViewportChange","onGeolocate","GeolocateControl","supportsGeolocation","markerPosition","console","warn","controlOptions","forEach","prop","props","control","_mapboxGeolocateControl","_watchState","_geolocateButton","_geolocateButtonRef","current","options","setAttribute","_updateMarker","_updateCamera","_setup","eventManager","_context","on","classList","add","remove","_map","map","trigger","position","setState","coords","center","LngLat","longitude","latitude","radius","accuracy","bounds","toBounds","_ne","lng","lat","_sw","viewport","_getBounds","zoom","fitBounds","newViewState","mapState","viewState","getViewportProps","type","callback","state","e","preventDefault","componentDidMount","then","result","_setupMapboxGeolocateControl","_triggerGeolocate","componentDidUpdate","prevProps","componentWillUnmount","geolocationWatchID","_geolocationWatchID","undefined","window","navigator","geolocation","clearWatch","_render","_renderMarker","_containerRef","_renderButton"],"mappings":"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","sourcesContent":["// @flow\n\n/* global window */\nimport * as React from 'react';\nimport {createRef} from 'react';\nimport PropTypes from 'prop-types';\nimport WebMercatorViewport from 'viewport-mercator-project';\n\nimport mapboxgl from '../utils/mapboxgl';\n\nimport BaseControl from './base-control';\nimport Marker from './marker';\nimport MapState from '../utils/map-state';\nimport TransitionManager from '../utils/transition-manager';\nimport {isGeolocationSupported} from '../utils/geolocate-utils';\n\nimport type {BaseControlProps} from './base-control';\n\nconst LINEAR_TRANSITION_PROPS = Object.assign({}, TransitionManager.defaultProps, {\n  transitionDuration: 500\n});\n\nconst noop = () => {};\n\nconst propTypes = Object.assign({}, BaseControl.propTypes, {\n  // Custom className\n  className: PropTypes.string,\n  style: PropTypes.object,\n  // Custom label assigned to the control\n  label: PropTypes.string,\n  // Auto trigger instead of waiting for click\n  auto: PropTypes.bool,\n\n  // mapbox geolocate options\n  // https://docs.mapbox.com/mapbox-gl-js/api/#geolocatecontrol\n  positionOptions: PropTypes.object,\n  fitBoundsOptions: PropTypes.object,\n  trackUserLocation: PropTypes.bool,\n  showUserLocation: PropTypes.bool,\n\n  // Callbacks fired when the user interacted with the map. The object passed to the callbacks\n  // contains viewport properties such as `longitude`, `latitude`, `zoom` etc.\n  onViewStateChange: PropTypes.func,\n  onViewportChange: PropTypes.func,\n\n  onGeolocate: PropTypes.func\n});\n\nconst defaultProps = Object.assign({}, BaseControl.defaultProps, {\n  className: '',\n  style: {},\n  label: 'Geolocate',\n  auto: false,\n\n  // mapbox geolocate options\n  positionOptions: null,\n  fitBoundsOptions: null,\n  trackUserLocation: false,\n  showUserLocation: true,\n\n  onGeolocate: () => {}\n});\n\nexport type GeolocateControlProps = BaseControlProps & {\n  className: string,\n  style: Object,\n  label: string,\n  auto: boolean,\n  positionOptions: any,\n  fitBoundsOptions: any,\n  trackUserLocation: boolean,\n  showUserLocation: boolean,\n  onViewStateChange?: Function,\n  onViewportChange?: Function,\n  onGeolocate?: Function\n};\n\ntype Coordinate = {\n  longitude: number,\n  latitude: number,\n  accuracy: number\n};\ntype Position = {\n  coords: Coordinate\n};\ntype State = {\n  supportsGeolocation: boolean,\n  markerPosition: ?Coordinate\n};\ntype GeolocateControlOptions = {\n  positionOptions?: any,\n  fitBoundsOptions?: any,\n  trackUserLocation?: boolean,\n  showUserLocation?: boolean\n};\n\nexport default class GeolocateControl extends BaseControl<\n  GeolocateControlProps,\n  State,\n  HTMLDivElement\n> {\n  static propTypes = propTypes;\n  static defaultProps = defaultProps;\n\n  state = {\n    supportsGeolocation: false,\n    markerPosition: null\n  };\n\n  _mapboxGeolocateControl: any = null;\n\n  _geolocateButtonRef: {current: null | HTMLButtonElement} = createRef();\n\n  componentDidMount() {\n    isGeolocationSupported().then(result => {\n      this.setState({supportsGeolocation: result});\n      this._setupMapboxGeolocateControl(result);\n      if (result && this.props.auto) {\n        this._triggerGeolocate();\n      }\n    });\n  }\n\n  componentDidUpdate(prevProps: GeolocateControlProps) {\n    // trigger geolocate when prop auto changes to true\n    // change to false has no effect\n    if (this.state.supportsGeolocation && !prevProps.auto && this.props.auto) {\n      this._triggerGeolocate();\n    }\n  }\n\n  componentWillUnmount() {\n    // re-implement MapboxGeolocateControl's _onRemove\n    // clear the geolocation watch if exists\n    if (this._mapboxGeolocateControl) {\n      const geolocationWatchID = this._mapboxGeolocateControl._geolocationWatchID;\n      if (geolocationWatchID !== undefined) {\n        window.navigator.geolocation.clearWatch(geolocationWatchID);\n        this._mapboxGeolocateControl._geolocationWatchID = undefined;\n      }\n    }\n  }\n\n  _setupMapboxGeolocateControl = (supportsGeolocation: boolean) => {\n    if (!supportsGeolocation) {\n      /* eslint-disable no-console, no-undef */\n      console.warn(\n        'Geolocation support is not available, the GeolocateControl will not be visible.'\n      );\n      /* eslint-enable no-console, no-undef */\n      return;\n    }\n\n    // For null option, use Mapbox default value\n    const controlOptions: GeolocateControlOptions = {\n      // disable showUserLocation to avoid Mapbox accessing marker before rendering\n      showUserLocation: false\n    };\n    ['positionOptions', 'fitBoundsOptions', 'trackUserLocation'].forEach(prop => {\n      if (prop in this.props && this.props[prop] !== null) {\n        controlOptions[prop] = this.props[prop];\n      }\n    });\n\n    const control = new mapboxgl.GeolocateControl(controlOptions);\n    this._mapboxGeolocateControl = control;\n\n    // the following re-implement MapboxGeolocateControl's _setupUI\n    // replace mapbox internal prop\n    control._watchState = 'OFF';\n\n    // replace mapbox internal UI elements\n    control._geolocateButton = this._geolocateButtonRef.current;\n    if (control.options.trackUserLocation && control._geolocateButton) {\n      control._geolocateButton.setAttribute('aria-pressed', 'false');\n    }\n\n    // replace mapbox internal methods\n    control._updateMarker = this._updateMarker;\n    control._updateCamera = this._updateCamera;\n\n    control._setup = true;\n\n    // when the camera is changed (and it's not as a result of the Geolocation Control) change\n    // the watch mode to background watch, so that the marker is updated but not the camera.\n    const {eventManager} = this._context;\n    if (control.options.trackUserLocation && eventManager) {\n      eventManager.on('panstart', () => {\n        if (control._watchState === 'ACTIVE_LOCK') {\n          control._watchState = 'BACKGROUND';\n          control._geolocateButton.classList.add('mapboxgl-ctrl-geolocate-background');\n          control._geolocateButton.classList.remove('mapboxgl-ctrl-geolocate-active');\n        }\n      });\n    }\n\n    control.on('geolocate', this.props.onGeolocate);\n  };\n\n  _triggerGeolocate = () => {\n    const control = this._mapboxGeolocateControl;\n    control._map = this._context.map;\n\n    if (this.props.showUserLocation) {\n      control.on('geolocate', this._updateMarker);\n      control.on('trackuserlocationend', this._updateMarker);\n    }\n\n    return this._mapboxGeolocateControl.trigger();\n  };\n\n  _updateMarker = (position: Position) => {\n    if (position) {\n      this.setState({markerPosition: position.coords});\n    }\n  };\n\n  _getBounds = (position: Position) => {\n    const center = new mapboxgl.LngLat(position.coords.longitude, position.coords.latitude);\n    const radius = position.coords.accuracy;\n    const bounds = center.toBounds(radius);\n\n    return [[bounds._ne.lng, bounds._ne.lat], [bounds._sw.lng, bounds._sw.lat]];\n  };\n\n  _updateCamera = (position: Position) => {\n    const {viewport} = this._context;\n\n    const bounds = this._getBounds(position);\n    const {longitude, latitude, zoom} = new WebMercatorViewport(viewport).fitBounds(bounds);\n\n    const newViewState = Object.assign({}, viewport, {\n      longitude,\n      latitude,\n      zoom\n    });\n    const mapState = new MapState(newViewState);\n    const viewState = Object.assign({}, mapState.getViewportProps(), LINEAR_TRANSITION_PROPS);\n\n    const onViewportChange = this.props.onViewportChange || this._context.onViewportChange || noop;\n    const onViewStateChange =\n      this.props.onViewStateChange || this._context.onViewStateChange || noop;\n\n    // Call new style callback\n    onViewStateChange({viewState});\n\n    // Call old style callback\n    onViewportChange(viewState);\n  };\n\n  _renderButton = (type: string, label: string, callback: Function) => {\n    return (\n      <button\n        key={type}\n        className={`mapboxgl-ctrl-icon mapboxgl-ctrl-${type}`}\n        ref={this._geolocateButtonRef}\n        type=\"button\"\n        title={label}\n        onClick={callback}\n      >\n        <span className=\"mapboxgl-ctrl-icon\" aria-hidden=\"true\" />\n      </button>\n    );\n  };\n\n  _renderMarker = () => {\n    const {markerPosition} = this.state;\n    const {showUserLocation} = this.props;\n    if (!markerPosition || !showUserLocation) {\n      return null;\n    }\n\n    return (\n      // $FlowFixMe\n      <Marker\n        key=\"location-maker\"\n        className=\"mapboxgl-user-location-dot\"\n        longitude={markerPosition.longitude}\n        latitude={markerPosition.latitude}\n        onContextMenu={e => e.preventDefault()}\n        captureDrag={false}\n        captureDoubleClick={false}\n      />\n    );\n  };\n\n  _render() {\n    if (!this.state.supportsGeolocation) {\n      return null;\n    }\n\n    const {className, style, label} = this.props;\n    return (\n      <div>\n        {this._renderMarker()}\n        <div\n          key=\"geolocate-control\"\n          className={`mapboxgl-ctrl mapboxgl-ctrl-group ${className}`}\n          ref={this._containerRef}\n          style={style}\n          onContextMenu={e => e.preventDefault()}\n        >\n          {this._renderButton('geolocate', label, this._triggerGeolocate)}\n        </div>\n      </div>\n    );\n  }\n}\n"],"file":"geolocate-control.js"}