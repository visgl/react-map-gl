الحصول على المصدر
قم بإنشاء مساحة عمل عميل جديدة:

  git clone --recurse-submodules https://gerrit.googlesource.com/gerrit
هذا --recurse-submodulesالخيار مطلوب git cloneللتأكد من أن المكونات الإضافية الأساسية ، والتي يتم تضمينها كوحدات git الفرعية ، مستنسخة أيضًا.

بعد ذلك ، قم بإعداد خطاف التنفيذ. يعد هذا ضروريًا للتأكد من أن كل التزام له ملف Change-Id.

  سي دي جيريت && (
    cd .git / هوكس
    ln -s ../../resources/com/google/gerrit/server/tools/root/hooks/commit-msg
  )
التبديل بين الفروع
عند الاستخدام git checkoutبدون --recurse-submodulesالتبديل بين الفروع ، لا يتم تغيير مراجعات الوحدة الفرعية ، مما قد يؤدي إلى:

مراجعات البرنامج المساعد غير صحيحة أو غير ضرورية.

المكونات الإضافية المفقودة.

بعد تبديل الفروع ، تأكد من أن لديك الإصدارات الصحيحة من الوحدات الفرعية.

حذر
إذا قمت بتخزين ملفات مشروع Eclipse أو IntelliJ في أدلة مصدر Gerrit ، فلا تقم بتشغيل git clean -fdx. قد يؤدي القيام بذلك إلى إزالة الملفات التي لم يتم تعقبها وإتلاف مشروعك. لمزيد من المعلومات ، راجع git-clean .
قم بتشغيل ما يلي:

  تحديث الوحدة الفرعية بوابة
  بوابة نظيفة ffd
تجميع
لمزيد من التفاصيل ، انظر البناء باستخدام Bazel .

اختبارات
إجراء اختبارات القبول
يحتوي Gerrit على اختبارات القبول التي تتحقق من صحة Gerrit daemon عبر REST و SSH وبروتوكول Git.

يتم إنشاء موقع مراجعة جديد لكل اختبار ثم يبدأ برنامج Gerrit daemon في ذلك الموقع. عند اكتمال الاختبار ، يتم إغلاق برنامج Gerrit daemon.

للحصول على إرشادات حول إجراء اختبارات القبول مع Bazel ، راجع إجراء اختبارات الوحدة مع Bazel .

الاختبارات الشاملة
يصف هذا المستند كيفية e2eتنفيذ سيناريوهات الاختبار (التحميل أو الوظيفية) باستخدام Gatling.

الملقم المحلي
تهيئة الموقع
بعد تجميع المشروع (أعلاه) ، قم بتشغيل الأمر Gerrit init لإنشاء موقع اختبار:

  تصدير GERRIT_SITE = ~ / gerrit_testsite
  $ (bazel info output_base) / external / local_jdk / bin / java \
      -jar bazel-bin / gerrit.war init - دفعة - ديف -d $ GERRIT_SITE
ملحوظة
يجب عليك استخدام نفس إصدار Java الذي استخدمه Bazel للإصدار ، والمتوفر في $(bazel info output_base)/external/local_jdk/bin/java.
يأخذ هذا الأمر معلمتين:

--batchيعين القيم الافتراضية للعديد من خيارات تكوين Gerrit. لمعرفة المزيد حول هذه الخيارات ، راجع التكوين .

--devيقوم بتهيئة خادم Gerrit لاستخدام خيار المصادقة ، DEVELOPMENT_BECOME_ANY_ACCOUNTوالذي يمكّنك من التبديل بين مستخدمين مختلفين لاستكشاف كيفية عمل Gerrit. لمعرفة المزيد حول إعداد Gerrit للتطوير ، راجع مراجعة كود Gerrit: إعداد المطور .

بعد تهيئة موقع الاختبار ، يبدأ Gerrit في تقديم الخدمة في الخلفية. يعرض مستعرض الويب صفحة البدء.

في صفحة البدء ، يمكنك:

قم بتسجيل الدخول بالحساب الذي قمت بإنشائه أثناء عملية التهيئة.

تسجيل حسابات إضافية.

أنشئ مشاريع.

لإغلاق البرنامج الخفي ، قم بتشغيل:

  توقف GERRIT_SITE دولار / bin / gerrit.sh
العمل مع الخادم المحلي
لإنشاء المزيد من الحسابات في مثيل التطوير الخاص بك:

انقر فوق "تصبح" في الزاوية اليمنى العليا.

حدد "تبديل المستخدم".

تسجيل حساب جديد.

قم بتكوين مفتاح SSH الخاص بك .

استخدم sshالبروتوكول للاستنساخ من الخادم المحلي والدفع إليه. على سبيل المثال ، لاستنساخ مستودع قمت بإنشائه من خلال واجهة المسؤول ، قم بتشغيل:

git clone ssh: // username @ localhost: 29418 / projectname
لاستخدام HTTPالبروتوكول ، قم بتشغيل:

git clone http: // username @ localhost: 8080 / projectname
كلمة المرور الافتراضية للمستخدم adminهي secret. يمكنك إعادة إنشاء كلمة مرور في واجهة المستخدم ضمن إعدادات المستخدم - بيانات اعتماد HTTP. يمكن تخزين كلمة المرور محليًا لتجنب إعادة كتابتها:

git config - مخزن بيانات الاعتماد العالمي
بوابة السحب
لإنشاء تغييرات كما يفعل مستخدمو Gerrit ، قم بتشغيل:

بوابة دفع الأصل HEAD: refs / for / master
تشغيل الشيطان
يمكن إطلاق البرنامج الخفي مباشرةً من منطقة البناء ، دون النسخ إلى موقع الاختبار:

  $ (bazel info output_base) / external / local_jdk / bin / java \
     -جار بازل بن / جيريت.وار الخفي -د $ GERRIT_SITE \
     - سجل وحدة التحكم
ملحوظة
لمعرفة سبب java -jarعدم كفاية الاستخدام ، راجع هذا الشرح .
ملحوظة
عند تشغيل daemong بهذه الطريقة ، لا يتم تكريم الإعدادات من [container]القسم من .$GERRIT_SITE/etc/gerrit.config
لتصحيح أخطاء خادم Gerrit لموقع الاختبار هذا:

افتح منفذ تصحيح (مثل المنفذ 5005). للقيام بذلك ، أدخل الكود التالي مباشرة بعد -jarالأمر السابق. لمعرفة كيفية إرفاق IntelliJ ، راجع تصحيح أخطاء خادم Gerrit بعيد .

-agentlib: jdwp = النقل = dt_socket ، الخادم = y ، التعليق = n ، العنوان = 5005
تشغيل البرنامج الخفي لتكريم إعدادات قسم [الحاوية]
لتشغيل برنامج Daemon وتكريم [container]إعدادات القسم ، استخدم gerrit.shالبرنامج النصي:

  $ cd $ GERRIT_SITE
  $ bin / gerrit.sh المدى
لتشغيل البرنامج الخفي في وضع التصحيح ، استخدم الخيار --debug:

  $ bin / gerrit.sh run --debug
منفذ التصحيح الافتراضي هو 8000. لتحديد منفذ تصحيح أخطاء مختلف ، استخدم --debug-portالخيار:

  $ bin / gerrit.sh run --debug --debug-port = 5005
الخيار --debug-addressموجود أيضًا وهو مرادف للخيار `--debug-port:

  $ bin / gerrit.sh run --debug --debug-address = 5005
لاحظ أنه ، بشكل افتراضي ، لن يقبل مصحح الأخطاء سوى الاتصالات من المضيف المحلي. لتمكين اتصالات تصحيح الأخطاء من مضيف (مضيفين) آخرين ، قدم أيضًا اسم مضيف أو حرف بدل في القيمة --debug-address :

  $ bin / gerrit.sh run --debug --debug-address = *: 5005
يتطلب تصحيح أخطاء بدء تشغيل برنامج Daemon بدء تشغيل JVM في وضع التصحيح المعلق. سينتظر JVM إرفاق مصحح أخطاء قبل متابعة البداية. استخدم --suspendالخيار لهذا السيناريو:

  $ bin / gerrit.sh run --debug - تعليق
تشغيل الشيطان مع مفتش جيريت
يعد Gerrit Inspector بيئة تفاعلية قابلة للبرمجة يمكنك استخدامها لفحص وتعديل الحالة الداخلية للنظام.

يظهر Gerrit Inspector على وحدة تحكم النظام عند بدء تشغيل النظام. ترك المفتش يغلق مثيل جيريت.

لاستكشاف الأخطاء وإصلاحها ، يقوم المفتش بتمكين العمل التفاعلي بالإضافة إلى تشغيل برامج Python النصية.

لبدء تشغيل المفتش ، أضف الخيار "-s" إلى أمر البدء الخفي:

  $ (bazel info output_base) / external / local_jdk / bin / java \
     -جار بازل بن / جيريت.وار الخفي -د $ GERRIT_SITE -s
ملحوظة
لمعرفة سبب java -jarعدم كفاية الاستخدام ، راجع هذا الشرح .
يفحص المفتش مكتبات Java ، ويحمل البرامج النصية للتهيئة ، ويبدأ موجه سطر الأوامر على وحدة التحكم:

  مرحبًا بكم في مفتش جيريت
  أدخل help () لرؤية ما سبق مرة أخرى ، EOF لإنهاء ووقف Gerrit
  جايثون 2.5.2 (Release_2_5_2: 7206 ، 2 آذار (مارس) 2011 ، 23:12:06)
  [OpenJDK 64-Bit Server VM (Sun Microsystems Inc.)] على java1.6.0 قيد التشغيل لـ
  جيريت 2.3-rc0-163-g01967ef
  >>>
عند تمكين المفتش ، يمكنك استخدام Gerrit كالمعتاد وستتوفر جميع الواجهات (بما في ذلك HTTP و SSH).

حذر
عند استخدام المفتش ، احرص على عدم تعديل الحالة الداخلية للنظام.
الإعداد لمطوري الواجهة الخلفية
تكوين الكسوف
لاستخدام Eclipse IDE للتطوير ، راجع إعداد Eclipse .

لتكوين مساحة عمل Eclipse مع Bazel ، راجع تكامل Eclipse مع Bazel .
